# 📖 Lilishop 官方前端部署说明

根据官方文档 https://docs.pickmall.cn/deply/deply.html

## 🔍 官方推荐的构建方式

### 前端构建命令

官方文档中的前端构建脚本：

```bash
cd ${code_path}/manager
yarn install
yarn build

cd ${code_path}/seller
yarn install
yarn build

cd ${code_path}/buyer
yarn install
yarn build
```

### 🔑 关键发现

**官方使用的是 `yarn` 而不是 `npm`！**

- 使用 `yarn install` 安装依赖
- 使用 `yarn build` 进行构建
- Node 版本要求：v14.16.0

---

## ⚠️ 我们的问题

我们在 Cloudflare Pages 使用 `npm` 导致依赖冲突。

### 解决方案选项

#### 选项 1：改用 Yarn（推荐）

在 Cloudflare Pages 配置：

```
Build command: yarn install && yarn build
Build output directory: dist
```

环境变量：
```
NODE_VERSION = 14.16.0
YARN_VERSION = 1.22.19
```

#### 选项 2：继续使用 npm + .npmrc

保持现有配置（已添加 .npmrc 文件）

---

## 💡 建议

根据官方文档，我们应该：

1. **改用 Yarn** 进行构建
2. **Node 版本降到 14.16.0**（官方推荐）
3. 不需要 `--legacy-peer-deps`，Yarn 处理依赖冲突更好

---

## 🎯 新的 Cloudflare Pages 配置

### Manager / Seller / Buyer 统一配置

```
Framework preset: Vue
Root directory: manager (或 seller / buyer)
Build command: yarn && yarn build
Build output directory: dist
```

### 环境变量

```
NODE_VERSION = 14.16.0
```

不需要 `NODE_OPTIONS` 环境变量！

---

## 📝 注意事项

1. Cloudflare Pages 默认支持 Yarn
2. Node 14 比 Node 18 更稳定（对于旧项目）
3. Yarn 的依赖解析比 npm 更宽松

---

**建议：使用 Yarn + Node 14 重新部署！**
